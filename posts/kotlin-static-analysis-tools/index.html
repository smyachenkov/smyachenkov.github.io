<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Kotlin Static Analysis Tools | Stanislav Myachenkov</title>
<meta name="keywords" content="programming, kotlin">
<meta name="description" content="Kotlin did an amazing job saving and including into its scope most of all valuable Java libraries, frameworks, and tools. But there is one type of tool that can&rsquo;t be easily imported and reused — static code analyzers. Java developers have implemented a lot of tools for code analysis, therefore, if you have worked with Java you might be familiar with some of the following projects: PMD, checkstyle, findbugs, spotbugs, etc. Sadly, these projeсts cannot be reused in other languages with different syntax and rules, such as Kotlin.">
<meta name="author" content="">
<link rel="canonical" href="https://smyachenkov.com/posts/kotlin-static-analysis-tools/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css" integrity="sha256-j&#43;ECM6cGvIfy4Is8&#43;XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://smyachenkov.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://smyachenkov.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://smyachenkov.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://smyachenkov.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://smyachenkov.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://smyachenkov.com/posts/kotlin-static-analysis-tools/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-V263ZCTJXL"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-V263ZCTJXL');
        }
      </script><meta property="og:url" content="https://smyachenkov.com/posts/kotlin-static-analysis-tools/">
  <meta property="og:site_name" content="Stanislav Myachenkov">
  <meta property="og:title" content="Kotlin Static Analysis Tools">
  <meta property="og:description" content="Kotlin did an amazing job saving and including into its scope most of all valuable Java libraries, frameworks, and tools. But there is one type of tool that can’t be easily imported and reused — static code analyzers. Java developers have implemented a lot of tools for code analysis, therefore, if you have worked with Java you might be familiar with some of the following projects: PMD, checkstyle, findbugs, spotbugs, etc. Sadly, these projeсts cannot be reused in other languages with different syntax and rules, such as Kotlin.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2019-06-16T00:00:00+03:00">
    <meta property="article:modified_time" content="2019-06-16T00:00:00+03:00">
    <meta property="article:tag" content="Programming">
    <meta property="article:tag" content="Kotlin">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Kotlin Static Analysis Tools">
<meta name="twitter:description" content="Kotlin did an amazing job saving and including into its scope most of all valuable Java libraries, frameworks, and tools. But there is one type of tool that can&rsquo;t be easily imported and reused — static code analyzers. Java developers have implemented a lot of tools for code analysis, therefore, if you have worked with Java you might be familiar with some of the following projects: PMD, checkstyle, findbugs, spotbugs, etc. Sadly, these projeсts cannot be reused in other languages with different syntax and rules, such as Kotlin.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://smyachenkov.com/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Kotlin Static Analysis Tools",
      "item": "https://smyachenkov.com/posts/kotlin-static-analysis-tools/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Kotlin Static Analysis Tools",
  "name": "Kotlin Static Analysis Tools",
  "description": "Kotlin did an amazing job saving and including into its scope most of all valuable Java libraries, frameworks, and tools. But there is one type of tool that can\u0026rsquo;t be easily imported and reused — static code analyzers. Java developers have implemented a lot of tools for code analysis, therefore, if you have worked with Java you might be familiar with some of the following projects: PMD, checkstyle, findbugs, spotbugs, etc. Sadly, these projeсts cannot be reused in other languages with different syntax and rules, such as Kotlin.\n",
  "keywords": [
    "programming", "kotlin"
  ],
  "articleBody": "Kotlin did an amazing job saving and including into its scope most of all valuable Java libraries, frameworks, and tools. But there is one type of tool that can’t be easily imported and reused — static code analyzers. Java developers have implemented a lot of tools for code analysis, therefore, if you have worked with Java you might be familiar with some of the following projects: PMD, checkstyle, findbugs, spotbugs, etc. Sadly, these projeсts cannot be reused in other languages with different syntax and rules, such as Kotlin.\nWhy do we need static analyzers JetBrains Team suggests using built-in inspections and rules in IntelliJ IDEA, but relying only on an IDE is not enough. It might be sufficient for very small projects with a single contributor, but it’s definitely not enough for huge projects that require teamwork and multiple contributors. Your team members are not perfect and can forget to fix inspection or ignore it intentionally because they don’t want to spend time on it. For these reasons we need tools that can be triggered on a build and fail pipelines to protect your project codebase from bugged and unreadable code.\nIn the CI/CD cycle, static analyzers are located in the TEST stage and check if new builds have errors, vulnerabilities, or if the number of code smells or potential bugs exceed some threshold.\nIn this post, I will take a look at popular tools for code analysis and implement custom rules for them.\nLet’s see what Kotlin infrastructure has to offer.\nktlint ktlint is a very powerful Kotlin static analyzer. It can be run as a command line tool, as a Gradle task, or as a Maven plugin. It’s a simple and reliable tool, and I won’t dwell on this subject, because ktlint documentation contains all the code samples required for successful ktlint integration.\nThe subject I want to focus on is creation of custom rules and rulesets.\nAll the code analyzers use the same pattern — a visitor for all the elements of an abstract syntax tree. And every rule makes a stop at every element of this tree such as: import directives, functions, constructors, method calls, arguments lists — every language element.\nclass CustomRule: Rule(\"custom-rule\") { override fun visit(node: ASTNode, autoCorrect: Boolean, emit: (offset: Int, errorMessage: String, canBeAutoCorrected: Boolean ) -\u003e Unit ) { if (node.elementType == KtNodeTypes.FUN) { emit(node.startOffset, \"Wrong function\", false) } } } This rule will trigger on every function in the project.\nLet’s do a more realistic case and trigger rules if a function name is longer than 20 symbols.\nprivate const val MAX_LENGTH = 20 class FunctionNameLength : Rule(\"function-name-length\") { override fun visit(node: ASTNode, autoCorrect: Boolean, emit: (offset: Int, errorMessage: String, canBeAutoCorrected: Boolean ) -\u003e Unit ) { if (node.elementType == KtNodeTypes.FUN) { node.children() .first { it.elementType == KtTokens.IDENTIFIER } .takeIf { it.textLength \u003e MAX_LENGTH } ?.let { emit( it.startOffset, \"Function name ${it.text} is longer than allowed $MAX_LENGTH symbols\", false ) } } } } And that’s almost all the code you have to write!\nTo complete this project, you need to implement your RuleSetProvider class where you specify all the ruleSetId that your ruleset contains:\nclass CustomRuleSetProvider : RuleSetProvider { override fun get() = RuleSet( \"custom-ruleset\", FunctionNameLength() ) } Also, you need to create a service file com.pinterest.ktlint.core.RuleSetProvider in the project’s META_INF directory /resources/META-INF/services/. The content of this file should be the full name of your RuleSetProvider class, for example, com.mycustomruleset.CustomRuleSetProvider.\nYou can build this project using Gradle with a couple of dependencies:\napply plugin: \"kotlin\" repositories { jcenter() } dependencies { compileOnly \"com.github.shyiko.ktlint:ktlint-core:$ktlintVersion\" testCompile \"com.github.shyiko.ktlint:ktlint-core:$ktlintVersion\" testCompile \"com.github.shyiko.ktlint:ktlint-test:$ktlintVersion\" } The whole project structure should look like this:\nsrc/ main/ resources/ META-INF/ services/ com.pinterest.ktlint.core.RuleSetProvider kotlin/ ktlintrules/ CustomRuleSetProvider.kt FunctionNameLength.kt build.gradle Here you can find a working example of a custom ktlint rule implementation: https://github.com/smyachenkov/kt-ruleset/tree/master/ktlint-rules.\ndetekt detekt is very similar to ktlint. It can be used as a build stage or as a ruleset for SonarQube.\nThere is a little difference between ktlint and detekt approaches. ktlint is focused on a minimalistic default configuration — you can just run the ktlint command without any arguments. The rationale for such approach is to not spend your valuable time on tools configuration and rather focus on the code of your project. On the other side, detekt makes it a lot easier to configure long and complex rulesets, rule inclusion, properties, weights, thresholds, etc. All of this configuration can be set in YAML config file.\nThe main difference between the implementation of ktlint and detekt rules is that ktlint requires you to manually check every element of an AST, while detekt provides you with a large number of visit methods that visit only specific language elements, such as constructor, import directives, named functions, lambdas, etc.\nclass CustomRule(config: Config = Config.empty) : Rule(config) { override val issue = Issue( javaClass.simpleName, Severity.CodeSmell, \"Code smell\", Debt.FIVE_MINS ) override fun visitCallExpression(expression: KtCallExpression) { report(CodeSmell( issue, Entity.from(expression), \"It's a code smell!\")) } override fun visitLambdaExpression(lambdaExpression: KtLambdaExpression) { report(CodeSmell( issue, Entity.from(lambdaExpression), \"It's a code smell!\" )) } override fun visitClass(klass: KtClass) { ... } override fun visitAnnotation(annotation: KtAnnotation) { ... } ... } Otherwise, both projects are pretty similar, and it won’t take you much effort to implement the same rule for both ktlint and detekt.\nLet’s implement our FunctionNameLength rule.\nprivate const val MAX_LENGTH = 20 class FunctionNameLength(config: Config = Config.empty) : Rule(config) { override val issue = Issue( javaClass.simpleName, Severity.CodeSmell, \"Code smell\", Debt.FIVE_MINS ) override fun visitNamedFunction(function: KtNamedFunction) { function.name?.let { if (it.length \u003e MAX_LENGTH) { report( CodeSmell( issue, Entity.from(function), \"Function name ${function.name} is longer than allowed $MAX_LENGTH\" ) ) } } } } The custom detekt ruleset project looks a lot like ktlint. It has almost the same structure:\nsrc/ main/ resources/ META-INF/ services/ io.gitlab.arturbosch.detekt.api.RuleSetProvider kotlin/ detektrules/ CustomRuleSetProvider.kt FunctionNameLength.kt build.gradle The differences are in the name of the service file — it should be named io.gitlab.arturbosch.detekt.api.RuleSetProvider, and in a slightly different RuleSetProvider implementation:\nclass CustomRuleSetProvider : RuleSetProvider { override val ruleSetId: String = \"custom-ruleset\" override fun instance(config: Config) = RuleSet( ruleSetId, listOf( NoBigDecimalDoubleConstructor(config), NoEmptyLineInMethodBody(config), FunctionNameLength(config) ) ) } To build the project, you will need the following dependencies:\napply plugin: \"kotlin\" repositories { jcenter() } dependencies { compileOnly \"com.github.shyiko.ktlint:ktlint-core:$ktlintVersion\" testCompile \"com.github.shyiko.ktlint:ktlint-core:$ktlintVersion\" testCompile \"com.github.shyiko.ktlint:ktlint-test:$ktlintVersion\" } Here you can find an example of the custom detekt rule implementation: https://github.com/smyachenkov/kt-ruleset/tree/master/detekt-rules.\nIntelliJ IDEA IntelliJ IDEA, a flagship JetBrains product has so many awesome and useful features, that you can discover new ways to code better again and again even if you are already have been doing it for years.\nIn this part, I will show you the ways to use IDEA inspections as a part of a project build or CI stage.\nInspections as a part of the build If you have ever used IDEA, you are familiar with its inspections that suggest improvements in the text editor. It’s a big list of known and popular bugs, code smells, style suggestions and best practices for many languages. Right now there are more than 100 Kotlin inspections bundled in Kotlin plugin for IntelliJ IDEA. Sometimes you may wonder — why am I skipping all that pile of knowledge when it can be included in my build or pipeline and prevent so many problems? There are a couple of ways to do it.\nFirst, IDEA comes with a built-in command line inspection tool. It requires an installed IDEA instance, so if you want to go this way — my suggestion is to build a Docker image with installed IntelliJ IDEA in your pipeline and run your project inside this image.\nSecond, there is inspection-plugin, that allows you to run IDEA inspections as a part of Gradle build. Right now this project is still in beta version and frozen, so it’s not the best solution for a reliable pipeline, but I hope its development will continue.\nCustom inspections If you have ever tried creating custom inspection for Java in IntelliJ IDEA you might be familiar with structural search. It allows you to search for elements of code and create custom inspections. It’s a pretty easy and quick way to implement new rules.\nUnfortunately, the structural search is currently not available for Kotlin language — https://youtrack.jetbrains.com/issue/KT-10176.\nBut if you really do want a new inspection, it won’t stop you, because it can be implemented via the IDEA inspection plugin. If you ever have written IDEA plugins, this should be similar to this type of project, if you didn’t do that — it’s not that hard, and JetBrains documentation provides good examples.\nThere is a couple of Kotlin-specific things you have to keep in mind:\nUse AbstractKotlinInspection as a parent class of your inspection instead of AbstractBaseJavaLocalInspectionTool\nAdd Kotlin dependency to plugin.xml org.jetbrains.kotlin\nAbstractKotlinInspection implementations share a similar approach with detekt rules: you have a lot of functions, that visit only specific language elements.\nclass CustomInspection : AbstractKotlinInspection() { override fun buildVisitor( holder: ProblemsHolder, isOnTheFly: Boolean ): PsiElementVisitor { return object: KtVisitorVoid() { override fun visitLambdaExpression(lambdaExpression: KtLambdaExpression) { holder.registerProblem(lambdaExpression as PsiElement, \"Lambda expression problem\") } override fun visitNamedFunction(function: KtNamedFunction) { holder.registerProblem(function, \"Named function problem\") } } } } Now let’s implement our FunctionNameLength rule.\nprivate const val MAX_LENGTH = 20 class FunctionNameLengthInspection : AbstractKotlinInspection() { override fun buildVisitor( holder: ProblemsHolder, isOnTheFly: Boolean ): PsiElementVisitor { return object: KtVisitorVoid() { override fun visitNamedFunction(function: KtNamedFunction) { function.name?.let { if (it.length \u003e MAX_LENGTH) { holder.registerProblem( function, \"Function name ${function.name} is longer than allowed $MAX_LENGTH\" ) } } } } } } As for any IntelliJ plugin, you need to provide the plugin.xml file in META-INF directory:\ncom.myinspectionplugin.kt-custom-inspection-plugin idea-rulesets Vendor Name Custom Kotlin ruleset for IDEA inspections org.jetbrains.kotlin ",
  "wordCount" : "1846",
  "inLanguage": "en",
  "datePublished": "2019-06-16T00:00:00+03:00",
  "dateModified": "2019-06-16T00:00:00+03:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://smyachenkov.com/posts/kotlin-static-analysis-tools/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Stanislav Myachenkov",
    "logo": {
      "@type": "ImageObject",
      "url": "https://smyachenkov.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://smyachenkov.com/" accesskey="h" title="Stanislav Myachenkov (Alt + H)">Stanislav Myachenkov</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://smyachenkov.com/posts" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://smyachenkov.com/tags" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://smyachenkov.com/index.xml" title="RSS Feed">
                    <span>RSS Feed</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Kotlin Static Analysis Tools
    </h1>
    <div class="post-meta"><span title='2019-06-16 00:00:00 +0300 +0300'>June 16, 2019</span>&nbsp;·&nbsp;9 min

</div>
  </header> 
  <div class="post-content"><p><a href="https://kotlinlang.org/">Kotlin</a> did an amazing job saving and including into its scope most of all valuable Java libraries, frameworks, and tools. But there is one type of tool that can&rsquo;t be easily imported and reused — <a href="https://wikipedia.org/wiki/Static_program_analysis">static code analyzers</a>. Java developers have implemented a lot of tools for code analysis, therefore, if you have worked with Java you might be familiar with some of the following projects: <a href="https://pmd.github.io/">PMD</a>, <a href="http://checkstyle.sourceforge.net/">checkstyle</a>, <a href="http://findbugs.sourceforge.net/">findbugs</a>, <a href="https://spotbugs.github.io/">spotbugs</a>, etc. Sadly, these projeсts cannot be reused in other languages with different syntax and rules, such as Kotlin.</p>
<h2 id="why-do-we-need-static-analyzers">Why do we need static analyzers<a hidden class="anchor" aria-hidden="true" href="#why-do-we-need-static-analyzers">#</a></h2>
<p>JetBrains Team suggests using built-in inspections and rules in IntelliJ IDEA, but relying only on an IDE is not enough. It might be sufficient for very small projects with a single contributor, but it&rsquo;s definitely not enough for huge projects that require teamwork and multiple contributors. Your team members are not perfect and can forget to fix inspection or ignore it intentionally because they don&rsquo;t want to spend time on it. For these reasons we need tools that can be triggered on a build and fail pipelines to protect your project codebase from bugged and unreadable code.</p>
<p><img alt="DevOps Cycle" loading="lazy" src="/images/3_kotlin_static_analysis_tools/devops_cycle.png"></p>
<p>In the CI/CD cycle, static analyzers are located in the TEST stage and check if new builds have errors, vulnerabilities, or if the number of code smells or potential bugs exceed some threshold.</p>
<p>In this post, I will take a look at popular tools for code analysis and implement custom rules for them.</p>
<p>Let&rsquo;s see what Kotlin infrastructure has to offer.</p>
<h2 id="ktlint">ktlint<a hidden class="anchor" aria-hidden="true" href="#ktlint">#</a></h2>
<p><a href="https://ktlint.github.io/">ktlint</a> is a very powerful Kotlin static analyzer. It can be run as a command line tool, as a Gradle task, or as a Maven plugin.
It&rsquo;s a simple and reliable tool, and I won&rsquo;t dwell on this subject, because ktlint documentation contains all the code samples required for successful ktlint integration.</p>
<p>The subject I want to focus on is creation of custom rules and rulesets.</p>
<p>All the code analyzers use the same pattern — a visitor for all the elements of an <a href="https://wikipedia.org/wiki/Abstract_syntax_tree">abstract syntax tree</a>. And every rule makes a stop at every element of this tree such as: import directives, functions, constructors, method calls, arguments lists — every language element.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Kotlin" data-lang="Kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CustomRule</span>: Rule(<span style="color:#e6db74">&#34;custom-rule&#34;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">visit</span>(node: ASTNode,
</span></span><span style="display:flex;"><span>                       autoCorrect: Boolean,
</span></span><span style="display:flex;"><span>                       emit: (offset: Int,
</span></span><span style="display:flex;"><span>                              errorMessage: String,
</span></span><span style="display:flex;"><span>                              canBeAutoCorrected: Boolean
</span></span><span style="display:flex;"><span>                       ) <span style="color:#f92672">-&gt;</span> Unit
</span></span><span style="display:flex;"><span>    ) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (node.elementType <span style="color:#f92672">==</span> <span style="color:#a6e22e">KtNodeTypes</span>.FUN) {
</span></span><span style="display:flex;"><span>            emit(node.startOffset, <span style="color:#e6db74">&#34;Wrong function&#34;</span>, <span style="color:#66d9ef">false</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This rule will trigger on every function in the project.</p>
<p>Let&rsquo;s do a more realistic case and trigger rules if a function name is longer than 20 symbols.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Kotlin" data-lang="Kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">val</span> MAX_LENGTH = <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FunctionNameLength</span> : Rule(<span style="color:#e6db74">&#34;function-name-length&#34;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">visit</span>(node: ASTNode,
</span></span><span style="display:flex;"><span>                       autoCorrect: Boolean,
</span></span><span style="display:flex;"><span>                       emit: (offset: Int,
</span></span><span style="display:flex;"><span>                              errorMessage: String,
</span></span><span style="display:flex;"><span>                              canBeAutoCorrected: Boolean
</span></span><span style="display:flex;"><span>                       ) <span style="color:#f92672">-&gt;</span> Unit
</span></span><span style="display:flex;"><span>    ) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (node.elementType <span style="color:#f92672">==</span> <span style="color:#a6e22e">KtNodeTypes</span>.FUN) {
</span></span><span style="display:flex;"><span>            node.children()
</span></span><span style="display:flex;"><span>                    .first { <span style="color:#66d9ef">it</span>.elementType <span style="color:#f92672">==</span> <span style="color:#a6e22e">KtTokens</span>.IDENTIFIER }
</span></span><span style="display:flex;"><span>                    .takeIf { <span style="color:#66d9ef">it</span>.textLength &gt; MAX_LENGTH }
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">?.</span>let {
</span></span><span style="display:flex;"><span>                        emit(
</span></span><span style="display:flex;"><span>                                <span style="color:#66d9ef">it</span>.startOffset,
</span></span><span style="display:flex;"><span>                                <span style="color:#e6db74">&#34;Function name </span><span style="color:#e6db74">${it.text}</span><span style="color:#e6db74"> is longer than allowed </span><span style="color:#e6db74">$MAX</span><span style="color:#e6db74">_LENGTH symbols&#34;</span>,
</span></span><span style="display:flex;"><span>                                <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>                        )
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>And that&rsquo;s almost all the code you have to write!</p>
<p>To complete this project, you need to implement your <code>RuleSetProvider</code> class where you specify all the ruleSetId that your ruleset contains:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Kotlin" data-lang="Kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CustomRuleSetProvider</span> : RuleSetProvider {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">get</span>() = RuleSet(
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;custom-ruleset&#34;</span>,
</span></span><span style="display:flex;"><span>            FunctionNameLength()
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Also, you need to create a service file <em>com.pinterest.ktlint.core.RuleSetProvider</em> in the project&rsquo;s META_INF directory /resources/META-INF/services/. The content of this file should be the full name of your RuleSetProvider class, for example, com.mycustomruleset.CustomRuleSetProvider.</p>
<p>You can build this project using Gradle with a couple of dependencies:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Groovy" data-lang="Groovy"><span style="display:flex;"><span>apply plugin: <span style="color:#e6db74">&#34;kotlin&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>repositories <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    jcenter<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dependencies <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    compileOnly <span style="color:#e6db74">&#34;com.github.shyiko.ktlint:ktlint-core:$ktlintVersion&#34;</span>
</span></span><span style="display:flex;"><span>    testCompile <span style="color:#e6db74">&#34;com.github.shyiko.ktlint:ktlint-core:$ktlintVersion&#34;</span>
</span></span><span style="display:flex;"><span>    testCompile <span style="color:#e6db74">&#34;com.github.shyiko.ktlint:ktlint-test:$ktlintVersion&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>The whole project structure should look like this:</p>
<pre tabindex="0"><code>src/
  main/
    resources/
      META-INF/
        services/
          com.pinterest.ktlint.core.RuleSetProvider
    kotlin/
      ktlintrules/
        CustomRuleSetProvider.kt
        FunctionNameLength.kt
build.gradle
</code></pre><p>Here you can find a working example of a custom ktlint rule implementation: <a href="https://github.com/smyachenkov/kt-ruleset/tree/master/ktlint-rules">https://github.com/smyachenkov/kt-ruleset/tree/master/ktlint-rules</a>.</p>
<h2 id="detekt">detekt<a hidden class="anchor" aria-hidden="true" href="#detekt">#</a></h2>
<p><a href="https://github.com/arturbosch/detekt">detekt</a> is very similar to ktlint. It can be used as a build stage or as a <a href="https://github.com/arturbosch/sonar-kotlin">ruleset for SonarQube</a>.</p>
<p>There is a little difference between ktlint and detekt approaches. ktlint is focused on a minimalistic default configuration — you can just run the ktlint command without any arguments. The rationale for such approach is to not spend your valuable time on tools configuration and rather focus on the code of your project. On the other side, detekt makes it a lot easier to configure long and complex rulesets, rule inclusion, properties, weights, thresholds, etc. All of this configuration can be set in <a href="https://arturbosch.github.io/detekt/configurations.html">YAML config file</a>.</p>
<p>The main difference between the implementation of ktlint and detekt rules is that ktlint requires you to manually check every element of an AST, while detekt provides you with a large number of visit methods that visit only specific language elements, such as constructor, import directives, named functions, lambdas, etc.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Kotlin" data-lang="Kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CustomRule</span>(config: Config = <span style="color:#a6e22e">Config</span>.empty) : Rule(config) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">val</span> issue = Issue(
</span></span><span style="display:flex;"><span>            javaClass.simpleName,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Severity</span>.CodeSmell,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Code smell&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Debt</span>.FIVE_MINS
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">visitCallExpression</span>(expression: KtCallExpression) {
</span></span><span style="display:flex;"><span>        report(CodeSmell(
</span></span><span style="display:flex;"><span>                issue,
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">Entity</span>.from(expression),
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;It&#39;s a code smell!&#34;</span>))
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">visitLambdaExpression</span>(lambdaExpression: KtLambdaExpression) {
</span></span><span style="display:flex;"><span>        report(CodeSmell(
</span></span><span style="display:flex;"><span>                issue,
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">Entity</span>.from(lambdaExpression),
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;It&#39;s a code smell!&#34;</span>
</span></span><span style="display:flex;"><span>        ))
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">visitClass</span>(klass: KtClass) {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">..</span>.
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">visitAnnotation</span>(<span style="color:#66d9ef">annotation</span>: KtAnnotation) {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">..</span>.
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span>.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Otherwise, both projects are pretty similar, and it won&rsquo;t take you much effort to implement the same rule for both ktlint and detekt.</p>
<p>Let&rsquo;s implement our FunctionNameLength rule.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Kotlin" data-lang="Kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">val</span> MAX_LENGTH = <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FunctionNameLength</span>(config: Config = <span style="color:#a6e22e">Config</span>.empty) : Rule(config) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">val</span> issue = Issue(
</span></span><span style="display:flex;"><span>            javaClass.simpleName,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Severity</span>.CodeSmell,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Code smell&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Debt</span>.FIVE_MINS
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">visitNamedFunction</span>(function: KtNamedFunction) {
</span></span><span style="display:flex;"><span>        function.name<span style="color:#f92672">?.</span>let {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">it</span>.length &gt; MAX_LENGTH) {
</span></span><span style="display:flex;"><span>                report(
</span></span><span style="display:flex;"><span>                    CodeSmell(
</span></span><span style="display:flex;"><span>                        issue,
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">Entity</span>.from(function),
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;Function name </span><span style="color:#e6db74">${function.name}</span><span style="color:#e6db74"> is longer than allowed </span><span style="color:#e6db74">$MAX</span><span style="color:#e6db74">_LENGTH&#34;</span>
</span></span><span style="display:flex;"><span>                    )
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The custom detekt ruleset project looks a lot like ktlint. It has almost the same structure:</p>
<pre tabindex="0"><code>src/
  main/
    resources/
      META-INF/
        services/
          io.gitlab.arturbosch.detekt.api.RuleSetProvider
    kotlin/
      detektrules/
        CustomRuleSetProvider.kt
        FunctionNameLength.kt
build.gradle
</code></pre><p>The differences are in the name of the service file — it should be named <em>io.gitlab.arturbosch.detekt.api.RuleSetProvider</em>, and in a slightly different RuleSetProvider implementation:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Kotlin" data-lang="Kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CustomRuleSetProvider</span> : RuleSetProvider {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">val</span> ruleSetId: String = <span style="color:#e6db74">&#34;custom-ruleset&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">instance</span>(config: Config) = RuleSet(
</span></span><span style="display:flex;"><span>            ruleSetId,
</span></span><span style="display:flex;"><span>            listOf(
</span></span><span style="display:flex;"><span>                    NoBigDecimalDoubleConstructor(config),
</span></span><span style="display:flex;"><span>                    NoEmptyLineInMethodBody(config),
</span></span><span style="display:flex;"><span>                    FunctionNameLength(config)
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>To build the project, you will need the following dependencies:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Groovy" data-lang="Groovy"><span style="display:flex;"><span>apply plugin: <span style="color:#e6db74">&#34;kotlin&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>repositories <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    jcenter<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dependencies <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    compileOnly <span style="color:#e6db74">&#34;com.github.shyiko.ktlint:ktlint-core:$ktlintVersion&#34;</span>
</span></span><span style="display:flex;"><span>    testCompile <span style="color:#e6db74">&#34;com.github.shyiko.ktlint:ktlint-core:$ktlintVersion&#34;</span>
</span></span><span style="display:flex;"><span>    testCompile <span style="color:#e6db74">&#34;com.github.shyiko.ktlint:ktlint-test:$ktlintVersion&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>Here you can find an example of the custom detekt rule implementation: <a href="https://github.com/smyachenkov/kt-ruleset/tree/master/detekt-rules">https://github.com/smyachenkov/kt-ruleset/tree/master/detekt-rules</a>.</p>
<h2 id="intellij-idea">IntelliJ IDEA<a hidden class="anchor" aria-hidden="true" href="#intellij-idea">#</a></h2>
<p><a href="https://www.jetbrains.com/idea/">IntelliJ IDEA</a>, a flagship JetBrains product has so many awesome and useful features, that you can discover new ways to code better again and again even if you are already have been doing it for years.</p>
<p>In this part, I will show you the ways to use IDEA inspections as a part of a project build or CI stage.</p>
<h3 id="inspections-as-a-part-of-the-build">Inspections as a part of the build<a hidden class="anchor" aria-hidden="true" href="#inspections-as-a-part-of-the-build">#</a></h3>
<p>If you have ever used IDEA, you are familiar with its inspections that suggest improvements in the text editor. It&rsquo;s a big list of known and popular bugs, code smells, style suggestions and best practices for many languages. Right now there are more than 100 Kotlin inspections <a href="https://github.com/JetBrains/kotlin/tree/master/idea/src/org/jetbrains/kotlin/idea/inspections">bundled in</a> Kotlin plugin for IntelliJ IDEA. Sometimes you may wonder — why am I skipping all that pile of knowledge when it can be included in my build or pipeline and prevent so many problems? There are a couple of ways to do it.</p>
<p>First, IDEA comes with a built-in <a href="https://www.jetbrains.com/help/idea/command-line-code-inspector.html">command line inspection tool</a>. It requires an installed IDEA instance, so if you want to go this way — my suggestion is to build a Docker image with installed IntelliJ IDEA in your pipeline and run your project inside this image.</p>
<p>Second, there is <a href="https://github.com/JetBrains/inspection-plugin/">inspection-plugin</a>, that allows you to run IDEA inspections as a part of Gradle build. Right now this project is still in beta version and frozen, so it&rsquo;s not the best solution for a reliable pipeline, but I hope its development will continue.</p>
<h3 id="custom-inspections">Custom inspections<a hidden class="anchor" aria-hidden="true" href="#custom-inspections">#</a></h3>
<p>If you have ever tried creating custom inspection for Java in IntelliJ IDEA  you might be familiar with <a href="https://www.jetbrains.com/help/idea/structural-search-and-replace.html">structural search</a>. It allows you to search for elements of code and <a href="https://www.jetbrains.com/help/idea/creating-custom-inspections.html">create custom inspections</a>. It&rsquo;s a pretty easy and quick way to implement new rules.</p>
<p>Unfortunately, the structural search is currently not available for Kotlin language — <a href="https://youtrack.jetbrains.com/issue/KT-10176">https://youtrack.jetbrains.com/issue/KT-10176</a>.</p>
<p><img alt="Sad Keanu" loading="lazy" src="/images/3_kotlin_static_analysis_tools/sad_keanu.jpg"></p>
<p>But if you really do want a new inspection, it won&rsquo;t stop you, because it can be implemented via the <a href="https://www.jetbrains.org/intellij/sdk/docs/tutorials/code_inspections.html">IDEA inspection plugin</a>. If you ever have written IDEA plugins, this should be similar to this type of project, if you didn&rsquo;t do that — it&rsquo;s not that hard, and JetBrains documentation provides good examples.</p>
<p>There is a couple of Kotlin-specific things you have to keep in mind:</p>
<ol>
<li>
<p>Use <code>AbstractKotlinInspection</code> as a parent class of your inspection instead of <code>AbstractBaseJavaLocalInspectionTool</code></p>
</li>
<li>
<p>Add Kotlin dependency to plugin.xml <code>&lt;depends&gt;org.jetbrains.kotlin&lt;/depends&gt;</code></p>
</li>
</ol>
<p>AbstractKotlinInspection implementations share a similar approach with detekt rules: you have a lot of functions, that visit only specific language elements.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Kotlin" data-lang="Kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CustomInspection</span> : AbstractKotlinInspection() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">buildVisitor</span>(
</span></span><span style="display:flex;"><span>        holder: ProblemsHolder,
</span></span><span style="display:flex;"><span>        isOnTheFly: Boolean
</span></span><span style="display:flex;"><span>    ): PsiElementVisitor {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">object</span>: KtVisitorVoid() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">visitLambdaExpression</span>(lambdaExpression: KtLambdaExpression) {
</span></span><span style="display:flex;"><span>                holder.registerProblem(lambdaExpression <span style="color:#66d9ef">as</span> PsiElement, <span style="color:#e6db74">&#34;Lambda expression problem&#34;</span>)
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">visitNamedFunction</span>(function: KtNamedFunction) {
</span></span><span style="display:flex;"><span>                holder.registerProblem(function, <span style="color:#e6db74">&#34;Named function problem&#34;</span>)
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Now let&rsquo;s implement our FunctionNameLength rule.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Kotlin" data-lang="Kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">val</span> MAX_LENGTH = <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FunctionNameLengthInspection</span> : AbstractKotlinInspection() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">buildVisitor</span>(
</span></span><span style="display:flex;"><span>        holder: ProblemsHolder,
</span></span><span style="display:flex;"><span>        isOnTheFly: Boolean
</span></span><span style="display:flex;"><span>    ): PsiElementVisitor {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">object</span>: KtVisitorVoid() {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">visitNamedFunction</span>(function: KtNamedFunction) {
</span></span><span style="display:flex;"><span>                function.name<span style="color:#f92672">?.</span>let {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">it</span>.length &gt; MAX_LENGTH) {
</span></span><span style="display:flex;"><span>                        holder.registerProblem(
</span></span><span style="display:flex;"><span>                                function,
</span></span><span style="display:flex;"><span>                                <span style="color:#e6db74">&#34;Function name </span><span style="color:#e6db74">${function.name}</span><span style="color:#e6db74"> is longer than allowed </span><span style="color:#e6db74">$MAX</span><span style="color:#e6db74">_LENGTH&#34;</span>
</span></span><span style="display:flex;"><span>                        )
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>As for any IntelliJ plugin, you need to provide the plugin.xml file in META-INF directory:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;idea-plugin&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;id&gt;</span>com.myinspectionplugin.kt-custom-inspection-plugin<span style="color:#f92672">&lt;/id&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;name&gt;</span>idea-rulesets<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;vendor&gt;</span>Vendor Name<span style="color:#f92672">&lt;/vendor&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;description&gt;</span>Custom Kotlin ruleset for IDEA inspections<span style="color:#f92672">&lt;/description&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;depends&gt;</span>org.jetbrains.kotlin<span style="color:#f92672">&lt;/depends&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;extensions</span> <span style="color:#a6e22e">defaultExtensionNs=</span><span style="color:#e6db74">&#34;com.intellij&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;localInspection</span> <span style="color:#a6e22e">language=</span><span style="color:#e6db74">&#34;kotlin&#34;</span>
</span></span><span style="display:flex;"><span>                         <span style="color:#a6e22e">displayName=</span><span style="color:#e6db74">&#34;No empty line in method body is allowed&#34;</span>
</span></span><span style="display:flex;"><span>                         <span style="color:#a6e22e">groupPath=</span><span style="color:#e6db74">&#34;Java&#34;</span>
</span></span><span style="display:flex;"><span>                         <span style="color:#a6e22e">groupBundle=</span><span style="color:#e6db74">&#34;messages.InspectionsBundle&#34;</span>
</span></span><span style="display:flex;"><span>                         <span style="color:#a6e22e">groupKey=</span><span style="color:#e6db74">&#34;group.names.probable.bugs&#34;</span>
</span></span><span style="display:flex;"><span>                         <span style="color:#a6e22e">enabledByDefault=</span><span style="color:#e6db74">&#34;true&#34;</span>
</span></span><span style="display:flex;"><span>                         <span style="color:#a6e22e">level=</span><span style="color:#e6db74">&#34;WARNING&#34;</span>
</span></span><span style="display:flex;"><span>                         <span style="color:#a6e22e">implementationClass=</span><span style="color:#e6db74">&#34;com.myinspectionplugin.FunctionNameLengthInspection&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/extensions&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;actions&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/actions&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/idea-plugin&gt;</span>
</span></span></code></pre></div><p>You will need the following dependencies to build this project:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Groovy" data-lang="Groovy"><span style="display:flex;"><span>plugins <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    id <span style="color:#e6db74">&#39;java&#39;</span>
</span></span><span style="display:flex;"><span>    id <span style="color:#e6db74">&#39;org.jetbrains.intellij&#39;</span> version <span style="color:#e6db74">&#39;0.4.9&#39;</span>
</span></span><span style="display:flex;"><span>    id <span style="color:#e6db74">&#39;org.jetbrains.kotlin.jvm&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>repositories <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    mavenCentral<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dependencies <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    implementation <span style="color:#e6db74">&#34;org.jetbrains.kotlin:kotlin-stdlib-jdk8&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>intellij <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    version <span style="color:#e6db74">&#39;2019.1&#39;</span>
</span></span><span style="display:flex;"><span>    plugins <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#e6db74">&#39;Kotlin&#39;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>Here you can find a full working example of the IDEA inspection plugin for Kotlin code: <a href="https://github.com/smyachenkov/kt-ruleset/tree/master/idea-inspections-plugin">https://github.com/smyachenkov/kt-ruleset/tree/master/idea-inspections-plugin</a>.</p>
<h2 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h2>
<p>If you want to see all the inspection from this post in action, <a href="https://github.com/smyachenkov/kt-ruleset/tree/master/demo">here</a> you can find a sample project that uses custom ktlint and detekt ruleset.</p>
<p>Static code analysis is an important part of a project builds or pipelines and you don&rsquo;t have to lose it after you switched from Java to Kotlin. There are various configurable and extendable tools for this, such as ktlint and detekt projects. Besides these tools, JetBrains IDE&rsquo;s are very powerful providers of programming language code styles. Right now, adding a new rule or including all IDE&rsquo;s inspections into your pipeline is possible, but can be tricky and it&rsquo;s easier to do it with another tool. Given the growing Kotlin popularity in the last years, we should expect static analyzers for Kotlin to continue improving and become even better.</p>
<h2 id="links">Links<a hidden class="anchor" aria-hidden="true" href="#links">#</a></h2>
<p>Repository with projects from this post — <a href="https://github.com/smyachenkov/kt-ruleset">https://github.com/smyachenkov/kt-ruleset</a></p>
<p>ktlint — <a href="https://ktlint.github.io/">https://ktlint.github.io/</a></p>
<p>detekt — <a href="https://arturbosch.github.io/detekt/index.html">https://arturbosch.github.io/detekt/index.html</a></p>
<p>JetBrains inspection plugin — <a href="https://github.com/JetBrains/inspection-plugin">https://github.com/JetBrains/inspection-plugin</a></p>
<p>IntelliJ IDEA code inspection plugin implementation tutorial — <a href="https://www.jetbrains.org/intellij/sdk/docs/tutorials/code_inspections.html">https://www.jetbrains.org/intellij/sdk/docs/tutorials/code_inspections.html</a></p>
<p>IntelliJ IDEA command line code inspector — <a href="https://www.jetbrains.com/help/idea/command-line-code-inspector.html">https://www.jetbrains.com/help/idea/command-line-code-inspector.html</a></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://smyachenkov.com/tags/programming/">Programming</a></li>
      <li><a href="https://smyachenkov.com/tags/kotlin/">Kotlin</a></li>
    </ul>

<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Kotlin Static Analysis Tools on x"
            href="https://x.com/intent/tweet/?text=Kotlin%20Static%20Analysis%20Tools&amp;url=https%3a%2f%2fsmyachenkov.com%2fposts%2fkotlin-static-analysis-tools%2f&amp;hashtags=programming%2ckotlin">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Kotlin Static Analysis Tools on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fsmyachenkov.com%2fposts%2fkotlin-static-analysis-tools%2f&amp;title=Kotlin%20Static%20Analysis%20Tools&amp;summary=Kotlin%20Static%20Analysis%20Tools&amp;source=https%3a%2f%2fsmyachenkov.com%2fposts%2fkotlin-static-analysis-tools%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Kotlin Static Analysis Tools on reddit"
            href="https://reddit.com/submit?url=https%3a%2f%2fsmyachenkov.com%2fposts%2fkotlin-static-analysis-tools%2f&title=Kotlin%20Static%20Analysis%20Tools">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Kotlin Static Analysis Tools on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsmyachenkov.com%2fposts%2fkotlin-static-analysis-tools%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Kotlin Static Analysis Tools on whatsapp"
            href="https://api.whatsapp.com/send?text=Kotlin%20Static%20Analysis%20Tools%20-%20https%3a%2f%2fsmyachenkov.com%2fposts%2fkotlin-static-analysis-tools%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Kotlin Static Analysis Tools on telegram"
            href="https://telegram.me/share/url?text=Kotlin%20Static%20Analysis%20Tools&amp;url=https%3a%2f%2fsmyachenkov.com%2fposts%2fkotlin-static-analysis-tools%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Kotlin Static Analysis Tools on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Kotlin%20Static%20Analysis%20Tools&u=https%3a%2f%2fsmyachenkov.com%2fposts%2fkotlin-static-analysis-tools%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://smyachenkov.com/">Stanislav Myachenkov</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
